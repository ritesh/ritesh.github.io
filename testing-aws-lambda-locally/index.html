<!DOCTYPE html>
<html lang="en-gb">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Ritesh Sinha">
    <meta name="description" content="Stuff I rant about">
    <meta name="generator" content="Hugo 0.42.2" />

    
    <title>Testing an AWS Lambda function locally &middot; @rsinha’s blog</title>

    <link rel="stylesheet" href="https://blog.rsinha.org/css/weblog.css" media="screen" charset="utf-8" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/1.2.14/css/lightgallery.min.css" type="text/css" />
    


    
	<link href="https://blog.rsinha.org/index.xml" rel="alternate" type="application/rss+xml" title="blog" />
	
  </head>
  <body class="site">

<header>
  <nav>
    <h1><a href="/">@rsinha</a>’s blog.</h1>
    <div class="menu">
      
      <ul>
        
            <li>
              <a href="/posts/">Posts</a>
              
                <a href="/posts/index.xml"><img src="/img/rss.svg" class="rss-icon" /></a>
              
            </li>
        
            <li>
              <a href="/microposts/">Snippets</a>
              
            </li>
        
        <li><a href="/about">About</a></li>
      </ul>
    </div>
  </nav>
</header>


  <main class="content">

    <article class="post">
      
        <h2><a rel="full-article" href="https://blog.rsinha.org/testing-aws-lambda-locally/">Testing an AWS Lambda function locally</a></h2>
      

      <div class="postmeta">Posted on <time datetime="2019-02-12 14:50:01 &#43;0000 UTC" pubdate="">February 12, 2019</time> in
        <span class="categories">
          
            <a class="category" href="/categories/til">til</a>, 
          
            <a class="category" href="/categories/aws"> aws</a>, 
          
            <a class="category" href="/categories/lambda"> lambda</a>
          
        </span>
      </div>

      <p>
        

<h1 id="integration-testing-lambda-functions-locally">Integration Testing Lambda Functions Locally</h1>

<p>Never had to test AWS Lambda functions locally (test in production YOLO).  I&rsquo;ve always ended up writing toy functions that I test using the console. For functions that are non-trivial and have to process different kinds of input events, it&rsquo;s probably best to test them locally to discover any regressions early on.</p>

<p>While walking through the docs with a colleague, we found that the nifty way to test a lambda function created <a href="https://docs.aws.amazon.com/lambda/latest/dg/serverless_app.html">using SAM</a> is to run:</p>

<p><code>$ sam local start-lambda</code></p>

<p>In the directory where you have your SAM <code>template.yml</code>. This is <code>LambdaInvoking</code> the function, as opposed to passing it an event via API Gateway. From the docs, write a quick script like this to then invoke the Lambda.</p>

<pre><code>import boto3
import botocore

# Set &quot;running_locally&quot; flag if you are running the integration test locally
running_locally = True

if running_locally:

    # Create Lambda SDK client to connect to appropriate Lambda endpoint
    lambda_client = boto3.client('lambda',
        region_name=&quot;eu-west-1&quot;,
        endpoint_url=&quot;http://127.0.0.1:3001&quot;,
        use_ssl=False,
        verify=False,
        config=botocore.client.Config(
            signature_version=botocore.UNSIGNED,
            read_timeout=30,
            retries={'max_attempts': 0},
        )
    )
else:
    lambda_client = boto3.client('lambda')


# Invoke your Lambda function as you normally usually do. The function will run
# locally if it is configured to do so
response = lambda_client.invoke(FunctionName=&quot;HelloFunction&quot;)

# Verify the response
assert response == &quot;Hello World&quot;
</code></pre>

<p>This is from the docs, but it took me a while to figure out that <code>FunctionName</code> above needs to refer to the <em>logical</em> name of your Lambda function in the CloudFormation template.</p>

<p>The first run will be slow as SAM will fetch the container for your function runtime, subsequent runs should be quicker (adjust <code>read_timeout</code>accordingly).</p>

<p>If you&rsquo;re a security nerd, the bits above that say <code>use_ssl=False</code> and <code>verify=False</code> should give you pause. In this instance, you&rsquo;re connecting to a service locally and not reaching out to the internet, so you&rsquo;re OK.</p>

      </p>
    </article>


  </main>

<footer>
  <div class="footer_text">
      <div>
        <h3>Hi, <a href="/about">I'm Ritesh</a></h3>
        <p>
          I'm easily <a href="http://xkcd.com/356/">nerd-sniped</a>. I also enjoy taking pictures. Find me <a href="https://twitter.com/rsinha">@rsinha</a> on twitter.

        </p>
      </div>
      
      <div>
          <h3><a href="https://www.flickr.com/photos/55603500@N04/">Photo Stream</a></h3>
          <div id="photos"></div>
        </div>
      </div>
      
  </div>

  
    <div class="footer_copyright">
      &copy; 2019 <a href="/about">Ritesh Sinha</a>
       - Made in London, UK
    </div>
  
</footer>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/2.2.0/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/1.2.14/js/lightgallery-all.min.js" charset="utf-8"></script>
    <script src="/js/weblog.js" charset="utf-8"></script>
    
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    _paq.push(['setTrackerUrl',  'https://api-5c01b6185ffbf6bfab59ddcc27f22388.rsinha.sandcats.io']);
    _paq.push(['setSiteId', 1]);
    _paq.push(['setApiToken', 'EJbYxKi8JhWDD3E7RJr30C-fSnfLkh5oL33Ju4CqaxI']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src='https://32jt3wu5wyoczgdu3w3b.rsinha.sandcats.io/embed.js'; s.parentNode.insertBefore(g,s);
  })();
</script>


    <script type="text/javascript">

  
  $(function() {
    
    $.getJSON("https://api.flickr.com/services/feeds/photos_public.gne?id=55603500@N04&format=json&jsoncallback=?", function(data) {
      iweblog.application.displayImages(data, 8);
    });
  });

</script>

    
  </body>
</html>

